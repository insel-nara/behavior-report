<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>행동발달 및 종합의견 조합 엔진 v4.8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .card-anim { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-anim:hover { transform: translateY(-5px); box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.08); }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-6xl mx-auto">
        <!-- 메인 헤더 영역 -->
        <div class="glass rounded-[3rem] p-10 mb-10 border border-slate-200 shadow-xl flex flex-col md:flex-row items-center justify-between gap-8">
            <div class="text-center md:text-left">
                <div class="inline-block px-4 py-1.5 mb-4 bg-indigo-100 text-indigo-700 rounded-full text-xs font-black tracking-widest uppercase">Professional Edition</div>
                <h1 class="text-4xl font-black text-slate-900 leading-tight">
                    행동발달 및 <span class="text-indigo-600">종합의견</span><br>조합 엔진 <span class="text-slate-400 text-2xl font-medium">v4.8</span>
                </h1>
                <p class="text-slate-500 mt-4 font-semibold italic">"450-500자 정밀 조합 및 음슴체 최적화 솔루션"</p>
            </div>
            <div class="flex flex-wrap justify-center gap-4 bg-white/50 p-5 rounded-[2.5rem] border border-white shadow-inner">
                <div class="flex items-center gap-3 px-5 border-r border-slate-200">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">학급 인원</span>
                    <select id="studentCount" onchange="createForms()" class="bg-transparent font-black text-xl text-indigo-600 outline-none cursor-pointer">
                        <option value="5">05</option>
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="30">30</option>
                        <option value="40">40</option>
                    </select>
                </div>
                <button onclick="generateAll()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3.5 rounded-2xl font-black transition-all active:scale-95 shadow-lg shadow-indigo-200">일괄 자동 생성</button>
                <button onclick="exportCSV()" class="bg-slate-900 hover:bg-black text-white px-8 py-3.5 rounded-2xl font-black transition-all active:scale-95">CSV 내보내기</button>
            </div>
        </div>

        <!-- 카드 컨테이너 -->
        <div id="container" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
    </div>

    <!-- 로딩 모달 -->
    <div id="loader" class="fixed inset-0 bg-slate-900/40 backdrop-blur-md hidden flex flex-col items-center justify-center z-50">
        <div class="bg-white p-12 rounded-[4rem] shadow-2xl flex flex-col items-center border border-white">
            <div class="relative w-20 h-20 mb-8">
                <div class="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <h2 class="text-2xl font-black text-slate-800">문장 고밀도 재구성 중</h2>
            <p class="text-slate-500 mt-3 font-medium">글자 수 정밀 조정(450~500자)을 수행하고 있음...</p>
        </div>
    </div>

    <script>
        // 데이터베이스: 더 길고 구체적인 고밀도 문장으로 보강
        const ELEMENTS = {
            "공동체": {
                "adj": ["매사에 이타적인 마음가짐을 바탕으로 주변을 먼저 배려하고 살피는 태도가 매우 탁월함.", "학급 공동체 의식이 남다르며 조화로운 분위기를 형성하는 능력이 동급생 중 단연 돋보임.", "학급의 화합과 발전을 위해 누구보다 앞장서서 헌신하는 모습이 교사와 교우들에게 큰 감동을 줌.", "배려심이 깊고 성품이 따뜻하며 정서적 안정감을 주어 학급의 평화로운 분위기를 주도함.", "성숙한 시민 의식을 내면화하여 공공의 가치를 소중히 여기고 솔선수범하는 자세를 일관되게 유지함."],
                "act": ["소외되거나 어려움을 겪는 교우를 세심하게 관찰하여 먼저 다가가 실질적인 도움을 주는 등 포용력이 우수함.", "학급 내 갈등이 발생할 때마다 중립적이고 합리적인 시각으로 문제를 분석하여 해결의 실마리를 제공함.", "학교 규칙 및 공공질서를 모범적으로 준수할 뿐만 아니라 타인에게도 긍정적인 생활 습관을 전파하는 파급력이 큼.", "교실 환경 개선과 학급 비품 관리에 대해 주인의식을 갖고 책임감 있게 참여하여 쾌적한 학습 환경 조성에 공헌함.", "웃어른께 예의 바르게 행동하고 인사를 생활화하며 바른 언어 사용을 실천하여 인성적 귀감이 됨."],
                "res": ["공동체의 신뢰를 한 몸에 받는 든든한 조력자로서 학급 공동체의 결속력을 강화하는 데 중추적 역할을 수행함.", "화합의 매개체 역할을 완벽히 소화하여 모두가 존중받는 민주적인 학급 문화를 정착시키는 데 기여함.", "자신보다 공동체를 먼저 생각하는 숭고한 희생정신을 보여주어 학급 전체의 행복 지수를 높이는 데 이바지함.", "타의 모범이 되는 생활 습관과 성숙한 인격을 겸비하여 향후 사회를 밝게 만드는 인재로 성장할 것임.", "조직 내 긍정적인 상호작용을 촉진하는 탁월한 리더십을 발휘하여 공동의 목표 달성에 결정적인 도움을 줌."]
            },
            "학습": {
                "adj": ["지적 호기심이 매우 왕성하여 새로운 지식을 탐구하고 자신의 것으로 내면화하는 과정에 몰입하는 힘이 강함.", "자기주도적인 학습 역량이 상당히 뛰어나며 스스로 학습의 우선순위를 정하고 목표를 달성하는 끈기가 대단함.", "학업적 열의가 남다르고 매 수업 시간마다 고도의 집중력을 발휘하여 지식 탐구의 본질을 이해하려 노력함.", "분석적이고 비판적인 사고력을 바탕으로 현상을 다각도에서 조망하고 문제의 핵심을 파악하는 능력이 출중함.", "끈기 있는 탐구 자세를 견지하여 고난도의 과업에도 굴하지 않고 끝까지 연구하여 해결책을 찾아냄."],
                "act": ["수업 시간마다 교사의 강의 내용을 깊이 있게 성찰하며 창의적인 질문을 던져 수업의 활기를 불어넣음.", "자신만의 체계적인 지식 습득 노하우를 정립하고 다양한 정보를 비판적으로 수용하여 논리적인 결론을 도출함.", "광범위한 독서 활동을 통해 인문학적 소양과 과학적 통찰력을 동시에 갖추어 융복합적 사고를 몸소 실천함.", "교과 과정에서 탐구한 내용을 실생활의 문제 해결과 연결하여 보고서를 작성하는 등 학문적 열정을 증명함.", "학급 내 학습 멘토링 활동에 주도적으로 참여하여 급우들의 성장을 돕고 협력적인 학습 분위기를 주도함."],
                "res": ["지속적인 자기 성찰과 학업적 정진을 통해 미래 사회의 변화를 이끌어갈 학문적 잠재력이 매우 풍부함.", "깊이 있는 통찰력과 창의적 대안 제시 능력을 갖추어 향후 특정 분야에서 두각을 나타낼 인재로 평가됨.", "사고의 유연성과 논리적 전개 과정을 명확히 입증하며 학업 성취 면에서 놀라운 성장을 이룩함.", "탁월한 집중력과 성실함을 겸비하여 어떤 환경에서도 자신의 역량을 십분 발휘할 우수한 학생으로 판단됨.", "학급 전체의 학업적 자극제 역할을 수행하며 집단 지성을 이끌어내는 데 핵심적인 공헌을 함."]
            },
            "소통": {
                "adj": ["개방적인 사고와 유연한 소통 태도를 견지하여 집단 내 의견을 조율하고 합의를 이끌어내는 역량이 우수함.", "타인의 감정에 깊이 공감하고 경청하는 태도가 내면화되어 있어 누구와도 원만한 관계를 형성하는 매력이 있음.", "협동적인 자세를 바탕으로 팀워크의 가치를 극대화하며 소통의 창구로서 구성원 간의 신뢰를 공고히 함.", "자신의 의사를 논리 정연하게 전달하면서도 상대방의 기분을 존중하는 세련된 화법을 구사함.", "경청과 수용의 미덕을 실천하며 타인의 장점을 발견하고 격려하는 포용력 있는 소통의 리더십을 발휘함."],
                "act": ["모둠 활동 시 팀원들의 의견을 조화롭게 수렴하고 명확한 목표를 제시하여 과업의 완성도를 획기적으로 높임.", "자신과 상충하는 의견도 겸허히 수용하고 이를 합리적인 대안으로 승화시키는 민주적인 소통 방식을 취함.", "적극적인 의사소통과 개방적인 마음으로 동료들과 긴밀히 협력하여 난관을 돌파하는 팀플레이 능력이 좋음.", "팀원의 숨은 역량을 파악하여 적재적소에 배치하고 동기를 부여하는 소통형 리더의 면모를 보여줌.", "토론이나 발표 상황에서 객관적인 데이터와 설득력 있는 논거를 사용하여 청중의 깊은 공감을 이끌어냄."],
                "res": ["협력의 시너지를 창출하는 뛰어난 대인관계 기술을 보유하여 조직 내에서 평판이 매우 좋고 신뢰가 두터움.", "원만한 조직 운영을 위한 소통의 윤활유 역할을 완벽히 수행하며 화합의 가치를 몸소 증명함.", "신뢰와 존중을 기반으로 한 인간관계를 통해 집단 내에 긍정적인 상호작용과 행복을 전파함.", "민주적 의사결정 과정을 능숙하게 이끌어 구성원 대다수가 만족할 수 있는 결실을 맺는 능력이 탁월함.", "포용력과 공감 능력을 갖춘 소통 전문가로서 향후 사회적 관계망에서 핵심적인 위치를 차지할 것으로 사료됨."]
            }
        };

        const REFINEMENT_MAP = [
            { patterns: ["산만", "집중못함", "떠듦"], replacement: "주변 환경에 매우 민감하고 다방면에 지적 호기심이 왕성하여 활동적인 에너지가 상당히 풍부함." },
            { patterns: ["소극", "자신감부족", "말수적음"], replacement: "신중하게 상황을 관조하며 자신의 내면을 깊이 있게 성찰하고 생각을 정리하는 정적인 에너지가 우수함." },
            { patterns: ["고집", "이기적", "독단"], replacement: "주관이 매우 뚜렷하고 자신이 설정한 목표를 향해 주도적으로 추진하는 추진력이 상당히 강력함." },
            { patterns: ["공부안함", "성적낮음", "의욕부족"], replacement: "미래 지향적인 잠재력이 무궁무진하며 적절한 동기 부여가 이루어질 때 비약적인 성장이 강력히 기대됨." },
            { patterns: ["싸움", "공격적", "다툼"], replacement: "매사에 활동적이고 에너지가 넘치며 자신의 표현에 솔직하여 이를 리더십으로 승화할 가능성이 큼." },
            { patterns: ["느림", "지각", "태만"], replacement: "자신만의 페이스를 유지하며 과업을 끝까지 꼼꼼하게 완수하려는 여유와 끈기 있는 성품이 장점임." }
        ];

        const KEY_MAP = {
            "공동체": ["배려", "봉사", "예의", "친구", "화합"],
            "학습": ["수업", "지식", "탐구", "문제", "학업"],
            "소통": ["모둠", "팀", "대화", "경청", "발표"]
        };

        function random(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        function shuffle(arr) { return [...arr].sort(() => Math.random() - 0.5); }

        function refineText(text) {
            let refined = text;
            REFINEMENT_MAP.forEach(item => {
                item.patterns.forEach(p => {
                    const regex = new RegExp(p, 'gi');
                    if (regex.test(refined)) {
                        refined = refined.replace(regex, item.replacement);
                    }
                });
            });
            refined = refined.replace(/합니다\./g, "함.").replace(/입니다\./g, "임.").replace(/한다\./g, "함.").replace(/이다\./g, "임.");
            return refined;
        }

        function createForms() {
            const count = document.getElementById('studentCount').value;
            const container = document.getElementById('container');
            container.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const card = document.createElement('div');
                card.className = "card-anim glass rounded-[2.5rem] p-7 border border-slate-200 flex flex-col gap-5";
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <span class="bg-indigo-600 text-white w-9 h-9 rounded-2xl flex items-center justify-center text-sm font-black shadow-lg shadow-indigo-100">${i}</span>
                            <input id="name-${i}" placeholder="성함" class="text-xl font-black outline-none border-b-2 border-transparent focus:border-indigo-400 w-28 bg-transparent transition-all">
                        </div>
                        <div id="counter-${i}" class="text-[11px] font-black px-3 py-1.5 rounded-xl bg-slate-100 text-slate-400 transition-all shadow-inner"><span id="val-${i}">0</span> / 500</div>
                    </div>
                    <textarea id="obs-${i}" class="obs-input w-full h-18 p-4 text-[13px] bg-white/50 border border-slate-100 rounded-[1.5rem] outline-none resize-none focus:ring-4 focus:ring-indigo-50 transition-all custom-scrollbar placeholder:text-slate-300" placeholder="교사가 개별적으로 관찰한 내용을 추가합니다."></textarea>
                    <div class="flex gap-2">
                        <button onclick="generate(${i})" class="flex-1 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 py-3 rounded-2xl text-xs font-black transition-all">문장 새로 고침</button>
                        <button onclick="copy(${i})" id="copy-${i}" class="px-6 bg-slate-800 text-white py-3 rounded-2xl text-xs font-black hover:bg-black transition-all">복사</button>
                    </div>
                    <textarea id="res-${i}" oninput="update(${i})" class="w-full h-52 p-5 text-[14px] bg-white border border-slate-100 rounded-[1.8rem] outline-none resize-none custom-scrollbar leading-[1.8] text-slate-700" placeholder="생성된 문장이 여기에 표시됨."></textarea>
                `;
                container.appendChild(card);
                const obsEl = card.querySelector(`#obs-${i}`);
                obsEl.addEventListener('input', () => handleObsInput(i));
            }
        }

        let inputTimers = {};
        function handleObsInput(id) {
            clearTimeout(inputTimers[id]);
            inputTimers[id] = setTimeout(() => generate(id), 500);
        }

        function generate(id) {
            const obsField = document.getElementById(`obs-${id}`);
            const resField = document.getElementById(`res-${id}`);
            if(!obsField || !resField) return;

            let rawObs = obsField.value.trim();
            let refinedObs = refineText(rawObs);
            if(refinedObs && !refinedObs.endsWith('.')) refinedObs += ".";

            let targetCat = "학습";
            let maxScore = -1;
            
            for(let c in KEY_MAP) {
                let score = 0;
                KEY_MAP[c].forEach(k => { if(rawObs.includes(k)) score++; });
                if(score > maxScore) { maxScore = score; targetCat = c; }
            }

            let sentences = [];
            // 기본 3개 카테고리 풀세트 결합
            Object.keys(ELEMENTS).forEach(c => {
                const cat = ELEMENTS[c];
                let s = `${random(cat.adj)} ${random(cat.act)} ${random(cat.res)}`;
                
                // 관찰 내용 삽입 (타겟 카테고리 문장 중간에 배치)
                if(c === targetCat && refinedObs) {
                    const dots = s.split('.');
                    s = dots[0] + ". " + refinedObs + " " + dots.slice(1).join('.');
                }
                sentences.push(s);
            });

            let final = shuffle(sentences).join(" ");

            // 450자 미만일 경우 추가 서술어 자동 보완
            let attempts = 0;
            while (final.length < 465 && attempts < 8) {
                let extraCat = random(Object.keys(ELEMENTS));
                let extraS = random(ELEMENTS[extraCat].res);
                if (!final.includes(extraS.substring(0, 15))) {
                    final += " " + extraS;
                }
                attempts++;
            }

            // 문장 정제 및 글자 수 최종 제어
            final = final.replace(/\.\s\./g, ".").replace(/\s+/g, ' ').trim();
            
            if (final.length > 500) {
                final = final.substring(0, 500);
                const lastDot = final.lastIndexOf('.');
                final = lastDot > 420 ? final.substring(0, lastDot + 1) : final;
            }

            resField.value = final;
            update(id);
        }

        function generateAll() {
            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            setTimeout(() => {
                const count = document.getElementById('studentCount').value;
                for(let i = 1; i <= count; i++) generate(i);
                loader.classList.add('hidden');
            }, 700);
        }

        function update(id) {
            const resField = document.getElementById(`res-${id}`);
            if(!resField) return;
            const len = resField.value.length;
            document.getElementById(`val-${id}`).textContent = len;
            const badge = document.getElementById(`counter-${id}`);

            // 450~500자 최적 상태 표시
            if(len >= 450 && len <= 500) {
                badge.className = "text-[11px] font-black px-3 py-1.5 rounded-xl bg-green-500 text-white shadow-lg shadow-green-100";
            } else if(len > 500) {
                badge.className = "text-[11px] font-black px-3 py-1.5 rounded-xl bg-red-500 text-white shadow-lg shadow-red-100";
            } else {
                badge.className = "text-[11px] font-black px-3 py-1.5 rounded-xl bg-slate-100 text-slate-400";
            }
        }

        function copy(id) {
            const t = document.getElementById(`res-${id}`);
            if(!t || !t.value) return;
            t.select();
            document.execCommand('copy');
            const btn = document.getElementById(`copy-${id}`);
            btn.textContent = "완료";
            setTimeout(() => btn.textContent = "복사", 1000);
        }

        function exportCSV() {
            let csv = "\uFEFF이름,행동특성및종합의견\n";
            const count = document.getElementById('studentCount').value;
            for(let i = 1; i <= count; i++) {
                const nameVal = document.getElementById(`name-${i}`).value || `학생${i}`;
                const resVal = document.getElementById(`res-${i}`).value.replace(/"/g, '""');
                csv += `"${nameVal}","${resVal}"\n`;
            }
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `행동발달_종합의견_결과_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }

        window.onload = createForms;
    </script>
</body>
</html>